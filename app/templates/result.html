<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>About Me</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    :root{
      --bg:#0e0f12; --panel:#18181c; --border:#2a2a31;
      --text:#e9eaee; --muted:#b7b9c3; --primary:#7b3ef0;
      --radius:22px;
    }
    html,body{background:var(--bg); color:var(--text); font-family:"Pretendard","Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

    .page { max-width:1200px; margin: 96px auto 96px; padding: 0 28px; }

    .page-title{
      font-size: clamp(40px, 4.6vw, 64px);
      font-weight: 800; letter-spacing:-0.02em;
      margin: 0 0 22px;
    }


    .profile-grid { display:grid; grid-template-columns: 1.2fr .9fr; gap:36px; align-items:start; }
    @media (max-width: 1060px){ .profile-grid{ grid-template-columns:1fr; gap:24px; } }

    .hello-title { font-size: clamp(48px, 5vw, 72px); line-height:1.05; font-weight: 700; margin: 0 0 8px; }
    .hello-sub   { font-size: clamp(34px, 3.2vw, 52px); font-weight: 650; color: var(--primary); margin: 0 0 28px; letter-spacing:-0.01em; }

    .card-dark { background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); padding:24px; }
    .btn { background:#1f1f27; border:1px solid #30303a; color:var(--text); border-radius:12px; padding:12px 16px; font-weight:800; text-decoration:none; }
    .btn.primary { background:var(--primary); border-color:#6d28d9; color:#fff; }
    .btns { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-top:28px; }

    .intro { display:flex; gap:26px; align-items:flex-start; }
    .avatar-wrap{
      width: 220px; height: 220px; border-radius: 32px; padding: 18px;
      background: radial-gradient(140px 140px at 30% 30%, #7b3ef0 0%, #4c2ca8 45%, transparent 60%),
                  radial-gradient(110px 110px at 80% 70%, #2f53ff55 0%, transparent 60%),
                  #0f0f12;
      border:1px solid #2c2c35; display:flex; align-items:center; justify-content:center;
    }
    .avatar-wrap img{ width: 160px; height: 160px; object-fit: contain; display:block; }

    .kv { margin: 10px 0; font-size:20px; }
    .kv span { color:var(--muted); margin-right: 10px; }

    /* Chat íŒ¨ë„ */
    .chat{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); padding:22px; display:flex; flex-direction:column; min-height:520px; }
    .chat h3{ margin:0 0 6px; font-size:32px; font-weight:800; }
    .chat small{ color:var(--muted); }
    .log{ flex:1; overflow:auto; padding:10px 6px 14px; margin-top:10px; }
    .bubble{ max-width: 88%; display:inline-block; padding:12px 14px; border-radius:16px; margin:8px 0; word-wrap:break-word; white-space:pre-wrap; font-size:16px; }
    .me{ align-self:flex-end; background:var(--primary); color:#fff; border-top-right-radius:10px; }
    .sys{ align-self:flex-start; background:#1f1f27; border:1px solid #2c2c35; color:var(--text); border-top-left-radius:10px; }
    .meta{ font-size:12px; color:var(--muted); margin:2px 4px 0; text-align:right; }
    .writer{ display:flex; gap:10px; margin-top:12px; }
    .writer textarea{ flex:1; background:#101015; border:1px solid var(--border); color:var(--text); border-radius:12px; padding:12px 14px; min-height:52px; resize:vertical; font-size:16px; }
  </style>

</head>
<body>
  <!-- ìƒë‹¨ë°” -->
  <header class="topbar">
    <div class="topbar__inner">
      <nav class="topbar__nav">
        <a href="{{ url_for('index') }}">Home</a>
        <a href="{{ url_for('contact') }}">Contact</a>
        <a href="https://github.com/" target="_blank">Github</a>
      </nav>
    </div>
  </header>

  <main class="page">
    <div class="profile-grid">
      <!-- Left: í”„ë¡œí•„ -->
      <section>
        <div class="intro">
          <div class="avatar-wrap">
            <img src="{{ member.avatar_url or url_for('static', filename='avatars/member1.png') }}" alt="avatar">
          </div>
          <div>
            <div class="hello-title">Hello!</div>
            <div class="hello-sub">I am {{ member.name }}</div>

            {% set _email = member.email or '' %}
            {% set _parts = _email.split('@') if '@' in _email else [_email, ''] %}
            {% set masked_email = (_parts[0][:1] ~ '***@' ~ _parts[1]) if _email else '' %}
            {% set _phone = (member.phone or '')|replace('-', '')|replace(' ', '') %}
            {% set masked_phone = (_phone[:3] ~ '-****-' ~ _phone[-4:]) if _phone|length >= 7 else member.phone %}

            <div class="kv"><span>Student ID:</span> <strong>{{ member.student_id }}</strong></div>
            <div class="kv"><span>Gender:</span> <strong>{{ member.gender or '-' }}</strong></div>
            <div class="kv"><span>Major:</span> <strong>{{ member.major or '-' }}</strong></div>
            <div class="kv">âœ‰ï¸ <span>{{ masked_email }}</span></div>
            <div class="kv">ğŸ“ <span>{{ masked_phone }}</span></div>
          </div>
        </div>

        <div class="card-dark" style="margin-top:18px">
          <div style="color:#b7b9c3;margin-bottom:6px">About Me</div>
          <div>{{ member.about }}</div>
        </div>

        <div class="btns">
          <a class="btn primary" href="{{ url_for('team_page') }}">íŒ€ ì „ì²´ ë³´ê¸°</a>
          <a class="btn" href="{{ url_for('input_page') }}">ì¶”ê°€ë¡œ ì…ë ¥í•˜ê¸°</a>
          <a class="btn" href="{{ url_for('index') }}">í™ˆìœ¼ë¡œ</a>
        </div>
      </section>

      <!-- Right: Chat -->
      <aside class="chat">
        <h3>Chat</h3>
        <small>í•˜ê³  ì‹¶ì€ ë§ì„ ììœ ë¡­ê²Œ ë‚¨ê²¨ë³´ì„¸ìš”.</small>
        <div id="log" class="log"></div>
        <div class="writer">
          <textarea id="msg" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></textarea>
          <button id="send" class="btn primary">ë³´ë‚´ê¸°</button>
          <button id="clear" class="btn" title="ëŒ€í™” ì§€ìš°ê¸°">ì§€ìš°ê¸°</button>
        </div>
      </aside>
    </div>
  </main>

  <script>
    // ===== Chat (localStorage by student_id) =====
    const sid = {{ (member.student_id or '0')|tojson }};
    const KEY = `chat_${sid}`;

    const logEl = document.getElementById('log');
    const msgEl = document.getElementById('msg');
    const sendBtn = document.getElementById('send');
    const clearBtn = document.getElementById('clear');

    function nowStr(){
      const d = new Date();
      const z = n => String(n).padStart(2,'0');
      return `${z(d.getHours())}:${z(d.getMinutes())}`;
    }
    function escapeHtml(s){
      return s.replace(/[&<>\"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
    }
    function load(){ try { return JSON.parse(localStorage.getItem(KEY) || '[]'); } catch { return []; } }
    function save(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }
    function render(){
      const arr = load();
      logEl.innerHTML = '';
      arr.forEach(m=>{
        const wrap = document.createElement('div');
        wrap.style.display = 'flex';
        wrap.style.flexDirection = 'column';
        wrap.appendChild(Object.assign(document.createElement('div'), {
          className: `bubble ${m.role || 'me'}`,
          innerHTML: escapeHtml(m.text)
        }));
        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.textContent = m.time || '';
        wrap.appendChild(meta);
        logEl.appendChild(wrap);
      });
      logEl.scrollTop = logEl.scrollHeight;
    }
    function send(){
      const text = msgEl.value.trim();
      if(!text) return;
      const arr = load();
      arr.push({ role:'me', text, time: nowStr() });
      save(arr);
      msgEl.value = '';
      render();
    }
    sendBtn.addEventListener('click', send);
    msgEl.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' && !e.shiftKey){
        e.preventDefault();
        send();
      }
    });
    clearBtn.addEventListener('click', ()=>{
      if(confirm('ì´ ì±„íŒ…ì„ ëª¨ë‘ ì§€ìš¸ê¹Œìš”?')){ localStorage.removeItem(KEY); render(); }
    });
    render();
  </script>
</body>
</html>